# 시나리오 유도 응답 생성 기능 요약

## 구현 완료 사항

### 1. 향상된 의도 분석
- `entity_agent.py`의 `analyze_user_intent` 개선
  - "질문", "혼란", "이탈" 등의 의도 감지
  - `scenario_deviation` 필드로 시나리오 이탈 여부 판단
  - `deviation_topic`으로 이탈 주제 파악

### 2. 자연스러운 시나리오 유도 응답
- `generate_natural_response` 함수 개선
  - 사용자 질문에 대한 친절한 답변
  - 답변 후 자연스럽게 현재 단계의 질문으로 유도
  - 미리 정의된 응답과 LLM 생성 응답 결합

### 3. 시나리오 유도 응답 템플릿
- `scenario_guidance_responses.yaml` 파일 생성
  - 각 단계별 예상 질문과 응답
  - 공통 질문에 대한 응답
  - 키워드 기반 매칭

## 사용 예시

### 예시 1: select_services 단계에서 한도계좌 질문
**사용자**: "한도계좌가 뭐야?"
**시스템**: 
```
한도계좌는 정부에서 지원하는 특별한 계좌로, 일반 계좌보다 높은 금리와 세금 혜택을 받을 수 있어요. 
1인당 최대 3개까지 가입 가능하고, 예금자보호 한도를 초과해도 원금과 이자를 보호받을 수 있습니다. 
지금 한도계좌로 만드시면 모바일 앱과 체크카드도 함께 이용하실 수 있는데, 어떻게 하시겠어요?
```

### 예시 2: security_medium_registration 단계에서 보안매체 질문
**사용자**: "OTP랑 보안카드 뭐가 좋아?"
**시스템**:
```
보안매체는 온라인 거래 시 본인 확인을 위한 도구입니다. 
OTP는 매번 새로운 일회용 비밀번호를 생성해서 가장 안전하고, 보안카드는 카드에 적힌 번호를 입력하는 방식이에요. 
신한 OTP가 편리하고 안전해서 많이 사용하시는데, 신한 OTP로 등록해드릴까요?
```

### 예시 3: additional_services 단계에서 부정적 응답
**사용자**: "필요없어요"
**시스템**:
```
알림 서비스는 무료이고 계좌 보안에 정말 중요해요. 
특히 요즘 보이스피싱이나 해킹 시도가 많아서 꼭 필요한 서비스입니다. 
나중에 해제도 가능하니 일단 신청해두시는 게 어떨까요? 
안전한 금융거래를 위해 모두 신청해드릴게요. 괜찮으시죠?
```

### 예시 4: 공통 - 취소 요청
**사용자**: "그만할래요"
**시스템**:
```
지금 중단하시면 처음부터 다시 진행하셔야 해요. 
조금만 더 진행하시면 계좌 개설이 완료됩니다. 
계속 진행하시는 게 어떨까요? 궁금하신 점이 있으시면 말씀해주세요.
```

## 로그 확인 방법

1. **🔍 [LLM_INTENT_ANALYSIS]**: 사용자 의도 분석
   - intent: "질문"인 경우 시나리오 유도 필요
   - scenario_deviation: true인 경우 이탈 감지

2. **🌐 [LLM_NATURAL_RESPONSE]**: 자연어 응답 생성
   - "🎯 시나리오 유도 포함" 로그 확인

## 주요 특징

1. **친절한 설명**: 사용자가 이해하기 쉽게 설명
2. **자연스러운 유도**: 설명 후 부드럽게 원래 질문으로 전환
3. **맥락 유지**: 현재 단계에 맞는 응답 생성
4. **유연한 처리**: 미리 정의된 응답이 없어도 LLM이 생성

## 향후 개선 사항

1. 더 많은 예상 질문과 응답 추가
2. 사용자 피드백 기반 응답 개선
3. 다국어 지원 (영어, 중국어 등)